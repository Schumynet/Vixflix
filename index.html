                        <span id="hero-runtime" class="text-gray-300"></span>
                    </div>
                    <p id="hero-overview" class="text-gray-300 mb-6 text-sm md:text-base"></p>
                    <div class="flex space-x-4">
                    <div class="flex space-x-4">
                        <button id="play-button" class="glass-button">
                            <i class="fas fa-play mr-2"></i> Play
                        </button>
                        <button id="more-info-button" class="glass-button">
                            <i class="fas fa-info-circle mr-2"></i> Info
                        </button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

    <!-- Main Content -->
    <main class="relative z-20 -mt-20 scrollbar-hide">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Trending Movies -->
            <!-- üé• Film in tendenza -->
<!-- üé• Film in tendenza -->
<section id="carousel-trending-movies" class="carousel-section">
  <h2 class="carousel-title">Film in tendenza</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-trending-movies-container">&#10094;</button>
    <div class="carousel-container" id="carousel-trending-movies-container"></div>
    <button class="carousel-arrow right" data-target="carousel-trending-movies-container">&#10095;</button>
  </div>
</section>

<!-- üì∫ Serie TV popolari -->
<section id="carousel-popular-tv" class="carousel-section">
  <h2 class="carousel-title">Serie TV popolari</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-popular-tv-container">&#10094;</button>
    <div class="carousel-container" id="carousel-popular-tv-container"></div>
    <button class="carousel-arrow right" data-target="carousel-popular-tv-container">&#10095;</button>
  </div>
</section>

<!-- ‚≠ê Film pi√π votati -->
<section id="carousel-top-rated-movies" class="carousel-section">
  <h2 class="carousel-title">Film pi√π votati</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-top-rated-movies-container">&#10094;</button>
    <div class="carousel-container" id="carousel-top-rated-movies-container"></div>
    <button class="carousel-arrow right" data-target="carousel-top-rated-movies-container">&#10095;</button>
  </div>
</section>

<!-- üé¨ Film al cinema -->
<section id="carousel-now-playing" class="carousel-section">
  <h2 class="carousel-title">Film al cinema</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-now-playing-container">&#10094;</button>
    <div class="carousel-container" id="carousel-now-playing-container"></div>
    <button class="carousel-arrow right" data-target="carousel-now-playing-container">&#10095;</button>
  </div>
</section>

<!-- üî´ Azione -->
<section id="carousel-action" class="carousel-section">
  <h2 class="carousel-title">Azione</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-action-container">&#10094;</button>
    <div class="carousel-container" id="carousel-action-container"></div>
    <button class="carousel-arrow right" data-target="carousel-action-container">&#10095;</button>
  </div>
</section>

<!-- üßô Fantasy -->
<section id="carousel-fantasy" class="carousel-section">
  <h2 class="carousel-title">Fantasy</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-fantasy-container">&#10094;</button>
    <div class="carousel-container" id="carousel-fantasy-container"></div>
    <button class="carousel-arrow right" data-target="carousel-fantasy-container">&#10095;</button>
  </div>
</section>

<!-- üé≠ Dramma -->
<section id="carousel-drama" class="carousel-section">
  <h2 class="carousel-title">Dramma</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-drama-container">&#10094;</button>
    <div class="carousel-container" id="carousel-drama-container"></div>
    <button class="carousel-arrow right" data-target="carousel-drama-container">&#10095;</button>
  </div>
</section>

<!-- üöÄ Fantascienza -->
<section id="carousel-scifi" class="carousel-section">
  <h2 class="carousel-title">Fantascienza</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-scifi-container">&#10094;</button>
    <div class="carousel-container" id="carousel-scifi-container"></div>
    <button class="carousel-arrow right" data-target="carousel-scifi-container">&#10095;</button>
  </div>
</section>

<!-- üëª Horror -->
<section id="carousel-horror" class="carousel-section">
  <h2 class="carousel-title">Horror</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-horror-container">&#10094;</button>
    <div class="carousel-container" id="carousel-horror-container"></div>
    <button class="carousel-arrow right" data-target="carousel-horror-container">&#10095;</button>
  </div>
</section>

<!-- üéì Dramma adolescenziale -->
<section id="carousel-teen-drama" class="carousel-section">
  <h2 class="carousel-title">Dramma adolescenziale</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-teen-drama-container">&#10094;</button>
    <div class="carousel-container" id="carousel-teen-drama-container"></div>
    <button class="carousel-arrow right" data-target="carousel-teen-drama-container">&#10095;</button>
  </div>
</section>

<!-- üíò Romantico -->
<section id="carousel-romantic" class="carousel-section">
  <h2 class="carousel-title">Romantico</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-romantic-container">&#10094;</button>
    <div class="carousel-container" id="carousel-romantic-container"></div>
    <button class="carousel-arrow right" data-target="carousel-romantic-container">&#10095;</button>
  </div>
</section>

<!-- üá∞üá∑ Korean Drama -->
<section id="carousel-korean-drama" class="carousel-section">
  <h2 class="carousel-title">Korean Drama</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-korean-drama-container">&#10094;</button>
    <div class="carousel-container" id="carousel-korean-drama-container"></div>
    <button class="carousel-arrow right" data-target="carousel-korean-drama-container">&#10095;</button>
  </div>
</section>

<!-- üá∞üá∑ Korean Movie -->
<section id="carousel-korean-movie" class="carousel-section">
  <h2 class="carousel-title">Korean Movie</h2>
  <div class="carousel-wrapper">
    <button class="carousel-arrow left" data-target="carousel-korean-movie-container">&#10094;</button>
    <div class="carousel-container" id="carousel-korean-movie-container"></div>
    <button class="carousel-arrow right" data-target="carousel-korean-movie-container">&#10095;</button>
  </div>
</section>

  
        </div>
    </main>

    <section id="search-results-section" class="hidden px-4 sm:px-6 lg:px-8 py-8">
  <h2 class="text-xl font-bold mb-4">Risultati per: <span id="search-query-text" class="text-primary"></span></h2>
  <div id="search-results-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
</section>


    <!-- Movie/TV Show Modal -->

<div id="movie-modal" class="fixed inset-0 z-50 hidden overflow-hidden flex items-center justify-center glass-modal hidden opacity-0 scale-95 transition-all duration-300 ease-[cubic-bezier(0.4,0,0.2,1)] origin-center">
    <div class="absolute inset-0 bg-black/70 backdrop-blur-sm"></div>
    <div class="relative max-w-[90%] max-h-[90vh] w-full overflow-hidden">
        <div class="max-h-[90vh] overflow-y-auto scrollbar-hide p-5 bg-secondary/85 backdrop-blur-2xl rounded-xl border border-white/10">
            <!-- Contenuto del modale -->
          <div class="flex justify-between items-start mb-4">
                    <div>
                        <h3 id="modal-title" class="text-2xl font-bold text-white mb-2">Titolo Film</h3>
                        <div class="flex items-center mb-4">
                            <span id="modal-rating" class="bg-primary text-white px-2 py-1 rounded-md text-sm font-bold mr-4">0.0</span>
                            <span id="modal-year" class="text-gray-300 mr-4">2023</span>
                            <span id="modal-runtime" class="text-gray-300">120 min</span>
                        </div>
                    </div>
                    <button id="close-modal" class="text-gray-400 hover:text-white text-2xl transition-colors duration-300">
                        &times;
                    </button>
                </div>
                
                <div class="flex flex-col md:flex-row gap-6">
                     <div class="w-full md:w-1/3 p-4 flex justify-center">
                <img id="modal-poster" 
                     src="" 
                     alt="Poster"
                     class="max-h-[400px] md:max-h-none w-auto object-contain rounded-lg shadow-lg">
            </div>
                    <div class="w-full md:w-2/3">
                        <p id="modal-overview" class="text-gray-300 mb-4">Movie overview goes here...</p>
                        
                        <div class="mb-4">
                            <h4 class="text-white font-semibold mb-2">Generi:</h4>
                            <div id="modal-genres" class="flex flex-wrap gap-2">
                                <!-- Genres will be added here -->
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <h4 class="text-white font-semibold mb-2">Cast:</h4>
                            <div id="modal-cast" class="flex flex-wrap gap-2">
                                <!-- Cast will be added here -->
                            </div>
                        </div>
                        
                        <div class="flex space-x-4 mt-6">
                            <button id="modal-play-button" class="glass-button bg-red-700 text-white px-6 py-2 rounded-md flex items-center transition-colors duration-300">
                                <i class="fas fa-play mr-2"></i> Play
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>

    <style>

        /* Tailwind utility class */
.scrollbar-hide {
    -ms-overflow-style: none;
    scrollbar-width: none;
}
.scrollbar-hide::-webkit-scrollbar {
    display: none;
}
        @media (max-width: 768px) {
  .glass-modal-content {
    width: 95% !important;
    max-width: 360px !important;
    max-height: 85vh !important;
    
  }

  /* Mobile-first responsive adjustments */

    #modal-poster {
        max-height: 300px !important; /* Altezza massima su mobile */
        width: auto !important;
        margin: 0 auto; /* Centratura */
    }
    
    .glass-modal-content {
        max-height: 90vh !important;
    }







  .glass-modal-content img {
    max-width: 50%;
    height: auto;
    margin-bottom: 1rem;
  }
}

/* Nascondi completamente la scrollbar in tutti i browser */
.glass-modal-content {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
}

/* WebKit (Chrome, Safari) */
.glass-modal-content::-webkit-scrollbar {
    display: none;
    width: 0 !important;
    height: 0 !important;
    background: transparent;
}

/* Rimuovi lo stile personalizzato della scrollbar che potrebbe essere in conflitto */
.glass-modal-content::-webkit-scrollbar-thumb {
    display: none;
}

.glass-modal-content::-webkit-scrollbar-track {
    display: none;
}

        /* Effetto glass per modali - versione pi√π pronunciata */
        .glass-modal {
            position: fixed;
            inset: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);

        }

        /* Classe per bloccare lo scroll del body */
.body-lock-scroll {
    overflow: hidden;
    position: fixed;
    width: 100%;
}
        
        .glass-modal-content {
            position: relative;
            background: rgba(34, 31, 31, 0.65);
            backdrop-filter: blur(24px) saturate(200%);
            -webkit-backdrop-filter: blur(24px) saturate(200%);
            border: 1px solid rgba(255, 255, 255, 0.18);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.36);
            border-radius: 12px;
            overflow: hidden;
            max-width: 90%;
            max-height: 90vh;
            transform-style: preserve-3d;
            animation: modalAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            overflow-y: auto; /* Abilita scroll solo nel modale se necessario */
            

        }
        
        .glass-modal-content::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(
                135deg,
                rgba(255, 255, 255, 0.12) 0%,
                rgba(255, 255, 255, 0.06) 50%,
                rgba(255, 255, 255, 0.12) 100%
            );
            z-index: -1;
            mix-blend-mode: overlay;
            opacity: 0.9;
        }
        
        .glass-modal-content::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255, 255, 255, 0) 0%,
                rgba(255, 255, 255, 0.15) 50%,
                rgba(255, 255, 255, 0) 100%
            );
            animation: shine 6s infinite;
            z-index: -1;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(20px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
    </style>
    <!-- Player Modal -->
    <div id="player-modal" class="fixed inset-0 z-50 overflow-hidden hidden bg-black">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="w-full max-w-5xl rounded-lg overflow-hidden shadow-2xl">
            <div class="video-container aspect-video group" id="videoContainer">
                <!-- Back button and title -->
                <div class="absolute top-0 left-0 z-10 p-4 flex items-center space-x-3 opacity-0 transition-opacity" id="backButtonContainer">
                    <button id="close-player" class="transition">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </button>
                    <h2 class="text-lg font-medium" id="player-title">Titolo Film</h2>
                    
                </div>
                
                <video id="videoPlayer" class="w-full h-full"></video>
                
                <!-- Loading overlay -->
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden" id="loadingOverlay">
                    <div class="loading-spinner text-4xl">
                        <i class="fas fa-circle-notch"></i>
                    </div>
                </div>
                
                <!-- Skip animations -->
                <div class="skip-animation skip-forward" id="skipForward">
                    +10s
                </div>
                <div class="skip-animation skip-backward" id="skipBackward">
                    -10s
                </div>

                <!-- Error overlay -->
                <div class="absolute inset-0 flex items-center justify-center bg-black bg-opacity-70 hidden" id="errorOverlay">
                    <div class="error-message p-6 rounded-lg text-center max-w-md">
                        <div class="text-red-500 text-4xl mb-3">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <h3 class="text-xl font-bold mb-2">Playback Error</h3>
                        <p class="text-gray-300 mb-4" id="errorText">Failed to load video stream. Please try again later.</p>
                        <button class="bg-primary hover:bg-red-700 px-4 py-2 rounded" id="retryButton">
                            <i class="fas fa-redo mr-2"></i> Retry
                        </button>
                    </div>
                </div>
<style>
/* Stile per il pulsante prossimo episodio */
.next-episode-btn {
    display: none;
    align-items: center;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 20px;
    color: white;
    padding: 6px 12px 6px 8px;
    font-size: 14px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-left: 10px;
}

.next-episode-btn:hover {
    background: rgba(255, 255, 255, 0.2);
}

.next-episode-text {
    margin-right: 6px;
}

.next-episode-btn i {
    font-size: 16px;
}

/* Animazioni */
@keyframes fadeIn {
    from { opacity: 0; transform: translateX(10px); }
    to { opacity: 1; transform: translateX(0); }
}

@keyframes fadeOut {
    from { opacity: 1; transform: translateX(0); }
    to { opacity: 0; transform: translateX(10px); }
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.prompt-content {
    text-align: center;
}

.prompt-content p {
    margin-bottom: 15px;
    font-size: 16px;
}

.prompt-buttons {
    display: flex;
    justify-content: center;
    gap: 10px;
}

.prompt-buttons button {
    padding: 8px 15px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    transition: background 0.2s;
}

.prompt-buttons button:hover {
    background: #e50914;
    color: white;
}
</style>                
                <!-- Controls -->
                <div class="controls-container" id="controlsContainer">
                    <!-- Progress bar -->
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    
                    <!-- Bottom controls -->
                    <div class="flex items-center justify-between">
                        <!-- Left controls -->
                        <div class="flex items-center space-x-4">
                            <button class="text-white hover:text-primary transition" id="playPauseBtn">
                                <i class="fas fa-play text-xl" id="playIcon"></i>
                            </button>
                            
                            <div class="flex items-center">
                                <button class="text-white hover:text-primary transition mr-2" id="volumeBtn">
                                    <i class="fas fa-volume-up text-lg" id="volumeIcon"></i>
                                </button>
                                <div class="volume-container flex items-center">
                                    <input type="range" min="0" max="1" step="0.01" value="1" 
                                           class="volume-slider accent-primary h-1" id="volumeSlider">
                                </div>
                            </div>
                            
                            <div class="text-sm text-gray-300">
                                <span id="currentTime">00:00</span> / 
                                <span id="duration">00:00</span>
                            </div>
                        </div>
                        
                        <!-- Right controls -->
                        <div class="flex items-center space-x-4">
                            <!-- Aggiungi questo accanto agli altri controlli del player -->
                            <button id="nextEpisodeBtn" class="next-episode-btn" title="Prossimo Episodio">
                                <span class="next-episode-text">Prossimo episodio</span>
                                <i class="fas fa-step-forward"></i>
                            </button>

                                
                            <div class="relative">
                                <button class="text-white hover:text-primary transition relative" id="captionsBtn">
                                    <i class="fas fa-closed-captioning text-lg"></i>
                                    <span class="absolute -top-1 -right-1 bg-primary text-xs rounded-full w-4 h-4 flex items-center justify-center hidden" id="captionsBadge">ON</span>
                                </button>
                                <div class="settings-menu" id="captionsMenu">
                                    <div class="px-4 py-2 border-b border-gray-700">
                                        <span class="text-gray-400 text-sm">Sottotitoli</span>
                                    </div>
                                    <div class="subtitle-options">
                                        <div class="subtitle-option px-4 py-2 cursor-pointer flex items-center justify-between" data-subtitle="none">
                                            <span>Disattivati</span>
                                            <i class="fas fa-check text-primary"></i>
                                        </div>
                                        <!-- Subtitle tracks will be added dynamically -->
                                    </div>
                                </div>
                            </div>
                            <div class="relative">
                                <button class="text-white hover:text-primary transition" id="audioTrackBtn">
                                    <i class="fas fa-language text-lg"></i>
                                </button>
                                <div class="settings-menu" id="audioMenu">
                                    <div class="px-4 py-2 border-b border-gray-700">
                                        <span class="text-gray-400 text-sm">Lingua Audio</span>
                                    </div>
                                    <div class="audio-options">
                                        <!-- Audio tracks will be added dynamically -->
                                    </div>
                                </div>
                            </div>
                            
                            <div class="relative">
                                <button class="text-white hover:text-primary transition" id="settingsBtn">
                                    <i class="fas fa-cog text-lg"></i>
                                </button>
                                <div class="settings-menu" id="settingsMenu">
                                    <div class="px-4 py-2 border-b border-gray-700">
                                        <span class="text-gray-400 text-sm">Qualit√†</span>
                                    </div>
                                    <div class="quality-options">
                                        <div class="quality-option px-4 py-2 cursor-pointer flex items-center justify-between" data-quality="auto">
                                            <span>Auto</span>
                                            <i class="fas fa-check text-primary hidden"></i>
                                        </div>
                                        <!-- Quality options will be added dynamically -->
                                    </div>
                                </div>
                            </div>
                            
                            <button class="text-white hover:text-primary transition" id="zoomBtn">
                                <i class="fas fa-search-plus text-lg"></i>
                            </button>
                            <button class="text-white hover:text-primary transition" id="fullscreenBtn">
                                <i class="fas fa-expand text-lg"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    /* Stile base del modale stagioni - uguale a quello film */
.season-episode-selector {
    position: fixed;
    inset: 0;
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 100;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    overflow-y: auto;
    padding: 20px;
}

.selection-container {
    position: relative;
    background: rgba(34, 31, 31, 0.65);
    backdrop-filter: blur(24px) saturate(200%);
    -webkit-backdrop-filter: blur(24px) saturate(200%);
    border: 1px solid rgba(255, 255, 255, 0.18);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.36);
    border-radius: 12px;
    overflow: hidden;
    max-width: 90%;
    max-height: 90vh;
    width: 100%;
    animation: modalAppear 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Header del modale */
.selection-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.5rem;
    background: rgba(0, 0, 0, 0.0);
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.selection-header h2 {
    color: white;
    font-size: 1.5rem;
    margin: 0;
}

.close-selector {
    background: none;
    border: none;
    color: white;
    font-size: 1.5rem;
    cursor: pointer;
    transition: color 0.3s;
}

.close-selector:hover {
    color: #E50914;
}

/* Contenuto scrollabile */
#selectorContent {
    padding: 1.5rem;
    max-height: 70vh;
    overflow-y: auto;
    scrollbar-width: none;
}

#selectorContent::-webkit-scrollbar {
    display: none;
}

/* Stile griglie stagioni/episodi */
.seasons-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    gap: 1rem;
}

.episodes-grid {
    display: grid;
    gap: 1rem;
}

/* Stile card stagioni/episodi */
.season-card, .episode-card {
    background: rgba(20, 20, 20, 0.0);
    border-radius: 8px;
    overflow: hidden;
    transition: transform 0.3s, box-shadow 0.3s;
    cursor: pointer;
}

.season-card:hover, .episode-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
}

.season-poster, .episode-still {
    width: 100%;
    object-fit: cover;
    background: #333;
}

.season-info, .episode-info {
    padding: 0.75rem;
}

.season-info h3, .episode-info h3 {
    color: white;
    margin: 0 0 0.25rem 0;
    font-size: 1rem;
}

.season-info p, .episode-info p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.875rem;
}

.episode-overview {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.75rem;
    margin-top: 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Pulsante torna indietro */
.back-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(229, 9, 20, 0.2);
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 4px;
    margin-bottom: 1rem;
    cursor: pointer;
    transition: background 0.3s;
}

.back-button:hover {
    background: rgba(229, 9, 20, 0.4);
}
</style>
<!-- Season/Episode Selector Modal -->
<div id="seasonEpisodeSelector" class="season-episode-selector glass-modal" style="display: none;">
    <div class="selection-container glass-modal-content">
        <div class="selection-header">
            <h2 id="selectorTitle">Seleziona Stagione</h2>
            <button class="close-selector" onclick="closeSeasonEpisodeSelector()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="selectorContent">
            <!-- Content will be loaded dynamically -->
        </div>
    </div>
</div>

    <!-- Footer -->
    <footer class="bg-secondary py-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-white font-semibold mb-4">Navigation</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Home</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Movies</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">TV Shows</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">New & Popular</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">My List</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white font-semibold mb-4">Legal</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">Terms of Service</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Privacy Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Cookie Policy</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">DMCA</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white font-semibold mb-4">Help</h3>
                    <ul class="space-y-2">
                        <li><a href="#" class="text-gray-400 hover:text-white">FAQ</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Contact Us</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-white">Feedback</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-white font-semibold mb-4">Connect</h3>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook-f"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-youtube"></i></a>
                    </div>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-gray-800">
                <p class="text-gray-400 text-sm">&copy; 2025 LeleFlix. All rights reserved.</p>
            </div>
        </div>
    </footer>
<!-- Aggiungi questo script prima del tuo script principale -->
     
    <script src="js/player.js" defer></script>
    <script>
        // TMDB API Configuration
        const API_KEY = '1e8c9083f94c62dd66fb2105cd7b613b';
        const API_URL = 'https://api.themoviedb.org/3';
        const IMG_PATH = 'https://image.tmdb.org/t/p/w1280';
        const POSTER_PATH = 'https://image.tmdb.org/t/p/w500';
        const PROXY_URL = 'https://api.leleflix.store/proxy/';
        
        // DOM Elements
        const trendingMoviesEl = document.getElementById('trending-movies');
        const popularTvEl = document.getElementById('popular-tv');
        const topRatedMoviesEl = document.getElementById('top-rated-movies');
        const upcomingMoviesEl = document.getElementById('upcoming-movies');
        const heroBackdropEl = document.getElementById('hero-backdrop');
        const heroTitleEl = document.getElementById('hero-title');
        const heroRatingEl = document.getElementById('hero-rating');
        const heroYearEl = document.getElementById('hero-year');
        const heroRuntimeEl = document.getElementById('hero-runtime');
        const heroOverviewEl = document.getElementById('hero-overview');
        const playButton = document.getElementById('play-button');
        const moreInfoButton = document.getElementById('more-info-button');
        const movieModal = document.getElementById('movie-modal');
        const playerModal = document.getElementById('player-modal');
        const closeModal = document.getElementById('close-modal');
        const closePlayer = document.getElementById('close-player');
        const modalPlayButton = document.getElementById('modal-play-button');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const closeMobileMenu = document.getElementById('close-mobile-menu');
        const mobileMenu = document.getElementById('mobile-menu');
        
document.querySelectorAll('nav a[href^="#"]').forEach(anchor => {
  anchor.addEventListener('click', () => {
    clearSearch(); // nasconde la vista ricerca se attiva
  });
});

async function searchMedia(query) {
  query = query?.trim() || document.getElementById("search-input").value.trim();
  if (!query) {
    document.body.classList.remove('show-search-results');
    document.getElementById("search-results-section").classList.add("hidden");
    return;
  }

  document.body.classList.add('show-search-results');
  document.getElementById("search-query-text").textContent = `"${query}"`;
  const resultsGrid = document.getElementById("search-results-grid");
  resultsGrid.innerHTML = `
    <div style="grid-column:1/-1; text-align:center; padding:40px;">
      <i class="fas fa-spinner fa-spin" style="font-size:2rem;"></i>
      <p>Ricerca in corso...</p>
    </div>
  `;
  document.getElementById("search-results-section").classList.remove("hidden");

try {
        const res = await fetch(`${API_URL}/search/multi?api_key=${API_KEY}&query=${encodeURIComponent(query)}&language=it-IT`);
        const data = await res.json();

        const filteredResults = (data.results || []).filter(item =>
            ['movie', 'tv'].includes(item.media_type) &&
            item.poster_path &&
            availableContent.some(ac => ac.tmdb_id === item.id)
        );

    if (filteredResults.length === 0) {
      resultsGrid.innerHTML = `
        <div style="grid-column:1/-1; text-align:center; padding:40px;">
          <i class="far fa-sad-tear" style="font-size:2rem;"></i>
          <p>Nessun risultato per "${query}"</p>
          <button onclick="clearSearch()" 
            style="margin-top:15px; background:#E50914; color:white; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;">
            Torna alla home
          </button>
        </div>
      `;
      return;
    }


        resultsGrid.innerHTML = filteredResults.map(item => {
            const isTV = item.media_type === 'tv';
            const title = isTV ? item.name : item.title;
            const year = (isTV ? item.first_air_date : item.release_date || '').split('-')[0] || 'N/D';

            return `
                <div class="cursor-pointer" onclick="handleResultClick(${item.id}, '${item.media_type}', ${JSON.stringify(item).replace(/"/g, '&quot;')})">
                    <img src="${POSTER_PATH}${item.poster_path}" alt="${title}" class="rounded-lg w-full h-64 object-cover">
                    <h3 class="mt-2 text-sm font-semibold truncate">${title}</h3>
                    <p class="text-gray-400 text-xs">${isTV ? 'Serie TV' : 'Film'} ‚Ä¢ ${year}</p>
                </div>
            `;
        }).join('');

  } catch (err) {
    console.error("Search error:", err);
    resultsGrid.innerHTML = `<p style="color:white;text-align:center;">Errore nella ricerca</p>`;
  }
}

// Gestione clic su risultato
async function handleResultClick(id, type, itemData = null) {
    try {
        // Usa i dati preliminari se disponibili, altrimenti fetch completo
        const detail = itemData ? { 
            ...itemData,
            media_type: type,
            id: id
        } : await getMovieDetails(id, type);

        // Aggiungi dati mancanti per la riproduzione
        if (!detail.title) detail.title = detail.name || 'Senza Titolo';
        if (!detail.backdrop_path) detail.backdrop_path = detail.poster_path;

        if (type === 'tv') {
            showTVSeasons(id, type);
        } else {
            playMovie(detail);
            
            // Gestione fullscreen
            const container = document.getElementById('videoContainer');
            if (container.requestFullscreen) {
                container.requestFullscreen().then(() => {
                    if (screen.orientation?.lock) {
                        screen.orientation.lock('landscape').catch(err => {
                            console.warn('Orientation lock failed:', err);
                        });
                    }
                });
            }
        }
    } catch (error) {
        console.error("Error handling result click:", error);
        alert("Si √® verificato un errore durante l'avvio della riproduzione");
    }
}

// Reset ricerca
function clearSearch() {
  document.body.classList.remove('show-search-results');
  document.getElementById("search-results-section").classList.add("hidden");
}



// Show season selector for a TV show
async function showTVSeasons(tvId, type) {
    const selector = document.getElementById('seasonEpisodeSelector');
    const selectorTitle = document.getElementById('selectorTitle');
    const selectorContent = document.getElementById('selectorContent');
    
    // Reset animation classes
    selector.classList.remove('opacity-100', 'scale-100');
    selector.classList.add('opacity-0', 'scale-95');
    
    // Show modal
    selector.style.display = 'flex';
    
    // Start animation
    setTimeout(() => {
        selector.classList.remove('opacity-0', 'scale-95');
        selector.classList.add('opacity-100', 'scale-100');
    }, 10);
    
    selectorTitle.textContent = 'Caricamento...';
    selectorContent.innerHTML = `
        <div class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Caricamento stagioni...</p>
        </div>
    `;
    
    try {
        // Fetch TV show details
        const response = await fetch(
            `https://api.themoviedb.org/3/tv/${tvId}?api_key=1e8c9083f94c62dd66fb2105cd7b613b&language=it-IT`
        );
        const data = await response.json();
        
        // Filter out seasons with 0 episodes
        const validSeasons = data.seasons.filter(season => season.episode_count > 0);
        
        // Update UI
        selectorTitle.textContent = 'Seleziona Stagione';
        selectorContent.innerHTML = `
            <div class="seasons-grid">
                ${validSeasons.map(season => `
                    <div class="season-card" onclick="showEpisodes(${tvId}, ${season.season_number})">
                        ${season.poster_path ? `
                            <img src="https://image.tmdb.org/t/p/w300${season.poster_path}" 
                                 alt="Stagione ${season.season_number}"
                                 class="season-poster" loading="lazy">
                        ` : `
                            <div class="season-poster" style="background: #333; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-tv" style="font-size: 2rem; color: #666;"></i>
                            </div>
                        `}
                        <div class="season-info">
                            <h3>Stagione ${season.season_number}</h3>
                            <p>${season.episode_count} episodi</p>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        
    } catch (error) {
        console.error("Error loading seasons:", error);
        selectorContent.innerHTML = `
            <div class="error-state">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Errore nel caricamento delle stagioni</p>
                <button onclick="showTVSeasons(${tvId}, '${type}')">Riprova</button>
            </div>
        `;
    }
}

function closeSeasonEpisodeSelector() {
    const selector = document.getElementById('seasonEpisodeSelector');
    selector.classList.add('opacity-0', 'scale-95');
    setTimeout(() => {
        selector.style.display = 'none';
        selector.classList.remove('opacity-100', 'scale-100');
    }, 300);
}

// Show episodes for selected season
async function showEpisodes(tvId, seasonNumber) {
    const selector = document.getElementById('seasonEpisodeSelector');
    const selectorTitle = document.getElementById('selectorTitle');
    const selectorContent = document.getElementById('selectorContent');

    selectorTitle.textContent = 'Caricamento...';
    selectorContent.innerHTML = `
        <div class="loading-state">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Caricamento episodi...</p>
        </div>
    `;

    try {
        const [seasonRes, tvRes] = await Promise.all([
            fetch(`${API_URL}/tv/${tvId}/season/${seasonNumber}?api_key=${API_KEY}&language=it-IT`),
            fetch(`${API_URL}/tv/${tvId}?api_key=${API_KEY}&language=it-IT`)
        ]);

        const seasonData = await seasonRes.json();
        const tvData = await tvRes.json();

        selectorTitle.textContent = `${tvData.name} - Stagione ${seasonNumber}`;

        const episodeCards = seasonData.episodes.map(episode => {
            const uniqueId = `${tvId}-${seasonNumber}-${episode.episode_number}`;
            episodeMap.set(uniqueId, { tvData, episodeData: episode }); // ‚úÖ Salva in memoria

            return `
                <div class="episode-card" onclick="playTVEpisode('${uniqueId}')">
                    ${episode.still_path ? `
                        <img src="https://image.tmdb.org/t/p/w300${episode.still_path}" 
                             alt="${episode.name || 'Episodio ' + episode.episode_number}"
                             class="episode-still" loading="lazy">
                    ` : `
                        <div class="episode-still" style="background: #333; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-play" style="font-size: 2rem; color: #666;"></i>
                        </div>
                    `}
                    <div class="episode-info">
                        <h3>Episodio ${episode.episode_number}</h3>
                        <p>${episode.name || 'Senza titolo'}</p>
                        ${episode.overview ? `
                            <div class="episode-overview">${episode.overview}</div>
                        ` : ''}
                    </div>
                </div>
            `;
        }).join('');

        selectorContent.innerHTML = `
            <button class="back-button" onclick="showTVSeasons(${tvId}, 'tv')">
                <i class="fas fa-arrow-left"></i> Torna alle stagioni
            </button>
            <div class="episodes-grid">${episodeCards}</div>
        `;
    } catch (error) {
        console.error("Errore nel caricamento degli episodi:", error);
        selectorContent.innerHTML = `
            <div class="error-state">
                <i class="fas fa-exclamation-triangle"></i>
                <p>Errore nel caricamento degli episodi</p>
                <button onclick="showEpisodes(${tvId}, ${seasonNumber})">Riprova</button>
            </div>
        `;
    }
}



function playTVEpisode(uniqueId) {
    closeSeasonEpisodeSelector();
    playMovie(uniqueId);
}

// Close the season/episode selector
function closeSeasonEpisodeSelector() {
    document.getElementById('seasonEpisodeSelector').style.display = 'none';
}



// Funzione di ricerca
async function performSearch(query) {
    if (!query.trim()) return;

    const res = await fetch(`${API_URL}/search/multi?api_key=${API_KEY}&language=it-IT&query=${encodeURIComponent(query)}`);
    const data = await res.json();

    const filteredResults = data.results.filter(item => 
        ['movie', 'tv'].includes(item.media_type) &&
        availableContent.some(content => content.tmdb_id === item.id)
    );

    if (filteredResults.length === 0) {
        alert("Nessun risultato disponibile.");
        return;
    }

    const content = await getMovieDetails(filteredResults[0].id, filteredResults[0].media_type);
    if (filteredResults[0].media_type === 'tv') {
        showTVSeasons(filteredResults[0].id, 'tv');
    } else {
        showMovieDetails(content, 'movie');
    }
}




 
// Aggiungere in cima allo script



        // Current movie for hero section
        let currentHeroMovie = null;

        // Add this near the top of your script section
let availableMovies = [];
const episodeMap = new Map(); // üîê archivio centrale degli episodi

// Add this near the top of your script section
let availableContent = [];



// Carica tutti i contenuti disponibili
async function loadAvailableContent() {
  try {
    const response = await fetch('https://api.leleflix.store/home/available');
    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
    
    const data = await response.json();
    availableContent = [...data.movies, ...data.tv];
    console.log('Loaded available content:', availableContent.length);
    
    // Aggiorna UI se necessario
    if (availableContent.length === 0) {
      console.warn('Nessun contenuto disponibile trovato');
    }
    
  } catch (error) {
    console.error('Error loading available content:', error);
    availableContent = [];
    
    // Mostra messaggio all'utente se necessario
    const errorEl = document.createElement('div');
    errorEl.className = 'bg-red-900 text-white p-4 rounded mb-4';
    errorEl.innerHTML = `
      <p>Errore nel caricamento dei contenuti disponibili</p>
      <p class="text-sm">${error.message}</p>
    `;
    document.querySelector('main').prepend(errorEl);
  }
}
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', async () => {
    await loadAvailableContent();
    
    // Then load all data
    getTrendingMovies();
    getPopularTv();
    getTopRatedMovies();
    getUpcomingMovies();
    getRandomHeroContent(); // Updated function name


    document.getElementById('search-button').addEventListener('click', () => searchMedia());
document.getElementById('search-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') searchMedia();
});
document.getElementById('mobile-search-button').addEventListener('click', () => searchMedia(document.getElementById('mobile-search-input').value));
document.getElementById('mobile-search-input').addEventListener('keydown', e => {
  if (e.key === 'Enter') searchMedia(e.target.value);
});
    
    // Update event listeners to handle both types
playButton.addEventListener('click', () => playMovie(currentHeroMovie));

    moreInfoButton.addEventListener('click', () => showMovieDetails(currentHeroMovie));
            closeModal.addEventListener('click', () => movieModal.classList.add('hidden'));
closePlayer.addEventListener('click', () => {
    const video = document.getElementById('videoPlayer');
    if (video) {
        if (window.hls) {
            window.hls.destroy();
            window.hls = null;
        }
        video.pause();
        video.removeAttribute('src');
        video.load();
    }

    document.getElementById('player-modal').classList.add('hidden');

    // Rimuovi blocco landscape se attivo
// Esci dal fullscreen se attivo
if (document.fullscreenElement) {
    document.exitFullscreen().catch(err => {
        console.warn("Uscita da fullscreen fallita:", err);
    });
} else if (document.webkitFullscreenElement) {
    document.webkitExitFullscreen();
}

// Sblocca orientamento se era bloccato
if (screen.orientation && screen.orientation.unlock) {
    try {
        screen.orientation.unlock();
    } catch (err) {
        console.warn('Impossibile sbloccare orientamento:', err);
    }
}



    // üîÅ Torna alla selezione episodi se stavamo guardando una serie
if (window.lastPlayedTV) {
    const { id, season } = window.lastPlayedTV;

    // Mostra il selettore
    const selector = document.getElementById('seasonEpisodeSelector');
    selector.style.display = 'flex';

    // Ricostruisci gli episodi
    showEpisodes(id, season);

    window.lastPlayedTV = null;
}
});


           const mobileSearchToggle = document.getElementById('mobile-search-toggle');
            const mobileSearchBox = document.getElementById('mobile-search-box');
            
            // 1. Gestione click sull'icona
            mobileSearchToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                mobileSearchBox.classList.toggle('active');
                
                // Focus sull'input quando appare
                if(mobileSearchBox.classList.contains('active')) {
                    setTimeout(() => {
                        document.getElementById('mobile-search-input').focus();
                    }, 50);
                }
            });
            
            // 2. Chiudi quando si clicca fuori
            document.addEventListener('click', function(e) {
                if(!mobileSearchBox.contains(e.target) && !mobileSearchToggle.contains(e.target)) {
                    mobileSearchBox.classList.remove('active');
                }
            });
            
            // 3. Chiudi dopo la ricerca
            document.getElementById('mobile-search-button').addEventListener('click', function() {
                mobileSearchBox.classList.remove('active');
            });



            
            // Close modals when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === movieModal) {
                    movieModal.classList.add('hidden');
                }
                if (e.target === playerModal) {
                    playerModal.classList.add('hidden');
                }
            });

        });
        
        // Fetch trending movies
// Modified getTrendingMovies function
// Modificare le funzioni di fetch per gestire meglio gli errori
async function getTrendingMovies() {
    try {
        const res = await fetch(`${API_URL}/trending/movie/week?api_key=${API_KEY}&language=it-IT`);
        if (!res.ok) throw new Error(`HTTP error! status: ${res.status}`);
        const data = await res.json();
        
        trendingMoviesEl.innerHTML = '';
        
const filteredMovies = data.results.filter(movie => 
        availableContent.some(item => item.tmdb_id === movie.id)
    );
        
        if (filteredMovies.length === 0) {
            trendingMoviesEl.innerHTML = '<p class="text-gray-400">Nessun film disponibile in tendenza</p>';
            return;
        }
        
        filteredMovies.slice(0, 10).forEach(movie => {
            const movieEl = createMovieCard(movie, 'movie');
            trendingMoviesEl.appendChild(movieEl);
        });
        
    } catch (error) {
        console.error('Error fetching trending movies:', error);
        trendingMoviesEl.innerHTML = '<p class="text-gray-400">Errore nel caricamento dei film</p>';
    }
}

// Similarly modify getTopRatedMovies
async function getTopRatedMovies() {
    const res = await fetch(`${API_URL}/movie/top_rated?api_key=${API_KEY}&language=it-IT`);
    const data = await res.json();
    
    topRatedMoviesEl.innerHTML = '';
    
    const filteredMovies = data.results.filter(movie => 
        availableContent.some(item => item.tmdb_id === movie.id)
    );
    
    filteredMovies.slice(0, 10).forEach(movie => {
        const movieEl = createMovieCard(movie, 'movie');
        topRatedMoviesEl.appendChild(movieEl);
    });
    
    if (filteredMovies.length === 0) {
        topRatedMoviesEl.innerHTML = '<p class="text-gray-400">No available movies found in top rated</p>';
    }
}

// Similarly modify getUpcomingMovies
async function getUpcomingMovies() {
    const res = await fetch(`${API_URL}/movie/upcoming?api_key=${API_KEY}&language=it-IT`);
    const data = await res.json();
    
    upcomingMoviesEl.innerHTML = '';
    
    const filteredMovies = data.results.filter(movie => 
        availableContent.some(item => item.tmdb_id === movie.id)
    );
    
    filteredMovies.slice(0, 10).forEach(movie => {
        const movieEl = createMovieCard(movie, 'movie');
        upcomingMoviesEl.appendChild(movieEl);
    });
    
    if (filteredMovies.length === 0) {
        upcomingMoviesEl.innerHTML = '<p class="text-gray-400">No available movies found in upcoming</p>';
    }
}
        
        // Fetch popular TV shows
// Modified getPopularTv function
async function getPopularTv() {
    const res = await fetch(`${API_URL}/tv/popular?api_key=${API_KEY}&language=it-IT`);
    const data = await res.json();
    
    popularTvEl.innerHTML = '';
    
    // Filter TV shows to only those in our available list
    const filteredTvShows = data.results.filter(tv => 
        availableContent.some(item => item.tmdb_id === tv.id)
    );
    
    filteredTvShows.slice(0, 10).forEach(tv => {
        const tvEl = createMovieCard(tv, 'tv');
        popularTvEl.appendChild(tvEl);
    });
    
    if (filteredTvShows.length === 0) {
        popularTvEl.innerHTML = '<p class="text-gray-400">No available TV shows found</p>';
    }
}
        

        
        // Get a random movie for hero section
// Modified getRandomHeroContent function
async function getRandomHeroContent() {
    // First get popular movies and TV shows
    const [moviesRes, tvRes] = await Promise.all([
        fetch(`${API_URL}/movie/popular?api_key=${API_KEY}`),
        fetch(`${API_URL}/tv/popular?api_key=${API_KEY}`)
    ]);
    
    const moviesData = await moviesRes.json();
    const tvData = await tvRes.json();
    
    // Combine and filter available content
    const allContent = [
        ...moviesData.results.map(item => ({ ...item, media_type: 'movie' }))
    ];
    
    const availablePopularContent = allContent.filter(item => 
        availableContent.some(avail => avail.tmdb_id === item.id)
    );
    
    if (availablePopularContent.length === 0) {
        console.log('No available popular content found for hero section');
        heroTitleEl.textContent = 'Welcome to LeleFlix';
        heroOverviewEl.textContent = 'Browse our collection of movies and TV shows';
        return;
    }
    
    // Get a random item from the available ones
    const randomIndex = Math.floor(Math.random() * availablePopularContent.length);
    const content = availablePopularContent[randomIndex];
    
    // Get full details
    const contentDetails = await getMovieDetails(content.id, content.media_type);
    
    currentHeroMovie = { ...contentDetails, media_type: content.media_type };
    displayHeroMovie(currentHeroMovie);
}


// Update displayHeroMovie to handle both types
function displayHeroMovie(content) {
    const isMobile = window.innerWidth <= 768;

    const clone = heroBackdropEl.cloneNode(true);
    clone.style.backgroundImage = `url(${IMG_PATH}${content.backdrop_path})`;
    clone.style.opacity = '0';
    clone.style.transition = 'opacity 0.5s ease-in-out';
    clone.style.position = 'absolute';
    clone.style.top = '0';
    clone.style.left = '0';
    clone.style.width = '100%';
    clone.style.height = '100%';
    
    // 2. Aggiungi il clone al DOM
    heroBackdropEl.parentNode.appendChild(clone);
    
    // 3. Attiva la transizione
    setTimeout(() => {
        clone.style.opacity = '1';
    }, 10);
    
    // 4. Al termine della transizione, aggiorna l'elemento originale e rimuovi il clone
    clone.addEventListener('transitionend', () => {
        heroBackdropEl.style.backgroundImage = `url(${IMG_PATH}${content.backdrop_path})`;
        clone.remove();
    }, { once: true });
    
    // Aggiorna il testo
    heroTitleEl.textContent = content.title || content.name;
    heroRatingEl.textContent = content.vote_average.toFixed(1);
    
    if (content.media_type === 'movie') {
        heroYearEl.textContent = content.release_date ? content.release_date.split('-')[0] : 'N/A';
        heroRuntimeEl.textContent = `${content.runtime} min`;
    } else {
        heroYearEl.textContent = content.first_air_date ? content.first_air_date.split('-')[0] : 'N/A';
        heroRuntimeEl.textContent = `${content.episode_run_time?.[0] || 'N/A'} min/ep`;
    }
    
    heroOverviewEl.textContent = content.overview;
    
    // Aggiungi classi per mobile
    if (isMobile) {
        document.querySelector('.hero-gradient').classList.add('mobile-contrast');
        heroTitleEl.classList.add('mobile-text-contrast');
        heroOverviewEl.classList.add('mobile-text-contrast');
    } else {
        document.querySelector('.hero-gradient').classList.remove('mobile-contrast');
        heroTitleEl.classList.remove('mobile-text-contrast');
        heroOverviewEl.classList.remove('mobile-text-contrast');
    }
}
        
        // Get movie or TV show details
async function getMovieDetails(id, type = 'movie') {
    try {
        // Get basic details
        const detailsRes = await fetch(`${API_URL}/${type}/${id}?api_key=${API_KEY}&language=it-IT`);
        const details = await detailsRes.json();
        
        // Get credits (cast)
        const creditsRes = await fetch(`${API_URL}/${type}/${id}/credits?api_key=${API_KEY}&language=it-IT`);
        const credits = await creditsRes.json();
        
        return {
            ...details,
            credits,
            media_type: type
        };
    } catch (error) {
        console.error('Error fetching details:', error);
        return {
            id,
            media_type: type,
            title: type === 'movie' ? 'Movie' : 'TV Show',
            name: type === 'tv' ? 'TV Show' : undefined,
            overview: 'Details not available',
            genres: [],
            credits: { cast: [] }
        };
    }
}
        
        
        
        // Create movie card element
 function createMovieCard(item, type = "movie") {
    const card = document.createElement("div");
    card.className = "movie-card cursor-pointer";
    card.dataset.id = item.id;
    card.dataset.type = type;
    
    // Aggiungi classe tv-card se √® una serie TV
    if (type === "tv") {
        card.classList.add("tv-card");
    }
    
    card.innerHTML = `
        <div class="movie-card-content">
            <div class="relative overflow-hidden rounded-lg h-64">
                <img src="${POSTER_PATH}${item.poster_path}" 
                     alt="${item.title || item.name}" 
                     class="w-full h-full object-cover">
                
                <!-- Rating -->
                <div class="absolute top-2 right-2 bg-black bg-opacity-70 text-white px-2 py-1 rounded-md text-xs font-bold">
                    ${item.vote_average.toFixed(1)}
                </div>
                
                <!-- Pulsante play con effetto glass -->
            </div>
            
            <!-- Titolo e anno -->
            <h3 class="mt-2 text-sm font-semibold truncate px-1">${item.title || item.name}</h3>
            <p class="text-gray-400 text-xs px-1">
                ${type === 'movie' ? 
                    (item.release_date ? item.release_date.split('-')[0] : 'N/A') : 
                    (item.first_air_date ? item.first_air_date.split('-')[0] : 'N/A')}
            </p>
        </div>
    `;
    
    // Aggiungi gestore eventi al click sulla card
    card.addEventListener("click", async () => {
        const details = await getMovieDetails(item.id, type);
        type === "tv" ? showTVSeasons(item.id, type) : showMovieDetails(details, type);
    });
    
document.addEventListener('click', (e) => {
    const playBtn = e.target.closest('.play-button-glass');
    if (playBtn) {
        e.preventDefault();
        e.stopPropagation();
        const id = parseInt(playBtn.dataset.id);
        const type = playBtn.dataset.type;
        playMovie(id, type);
    }
});
    return card;
}

let scrollPosition = 0;

function lockScroll() {
    scrollPosition = window.pageYOffset;
    document.body.classList.add('lock-scroll');
    document.body.style.top = `-${scrollPosition}px`;
}

function unlockScroll() {
    document.body.classList.remove('lock-scroll');
    document.body.style.top = '';
    window.scrollTo(0, scrollPosition);
}




async function showMovieDetails(content, type = null) {
    const contentType = content.media_type || type || 'movie';
    const movieModal = document.getElementById('movie-modal');
    
    // Salva TUTTI i dati nel modale, non solo ID e tipo
    movieModal.dataset.currentContent = JSON.stringify({
        ...content,
        media_type: contentType
    });
    // Show the modal immediately (skeleton)
    movieModal.classList.remove('hidden');
            setTimeout(() => {
        movieModal.classList.remove('opacity-0', 'scale-95');
        movieModal.classList.add('opacity-100', 'scale-100');
    }, 10);
    
    // Set basic info
    document.getElementById('modal-title').textContent = content.title || content.name || 'Untitled';
    document.getElementById('modal-rating').textContent = content.vote_average?.toFixed(1) || 'N/A';
    
    if (contentType === 'movie') {
        document.getElementById('modal-year').textContent = content.release_date ? content.release_date.split('-')[0] : 'N/A';
        document.getElementById('modal-runtime').textContent = `${content.runtime || 'N/A'} min`;
    } else {
        document.getElementById('modal-year').textContent = content.first_air_date ? content.first_air_date.split('-')[0] : 'N/A';
        document.getElementById('modal-runtime').textContent = `${content.episode_run_time?.[0] || 'N/A'} min/ep`;
    }
    
    // Set poster image
    const posterImg = document.getElementById('modal-poster');
    if (content.poster_path) {
        posterImg.src = `${POSTER_PATH}${content.poster_path}`;
        posterImg.alt = content.title || content.name || 'Poster';
    } else {
        posterImg.src = 'data:image/svg+xml;charset=UTF-8,%3Csvg%20width%3D%22300%22%20height%3D%22450%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20300%20450%22%20preserveAspectRatio%3D%22none%22%3E%3Cdefs%3E%3Cstyle%20type%3D%22text%2Fcss%22%3E%23holder_189b4b8b7b9%20text%20%7B%20fill%3A%23eceeef%3Bfont-weight%3Abold%3Bfont-family%3AArial%2C%20Helvetica%2C%20Open%20Sans%2C%20sans-serif%2C%20monospace%3Bfont-size%3A15pt%20%7D%20%3C%2Fstyle%3E%3C%2Fdefs%3E%3Cg%20id%3D%22holder_189b4b8b7b9%22%3E%3Crect%20width%3D%22300%22%20height%3D%22450%22%20fill%3D%22%2355595c%22%3E%3C%2Frect%3E%3Cg%3E%3Ctext%20x%3D%22112.5%22%20y%3D%22230.7%22%3ENo%20Poster%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fg%3E%3C%2Fsvg%3E';
    }
    
    // Set overview
    document.getElementById('modal-overview').textContent = content.overview || 'No overview available.';
    
    // Clear previous genres and cast
    const genresEl = document.getElementById('modal-genres');
    const castEl = document.getElementById('modal-cast');
    genresEl.innerHTML = '';
    castEl.innerHTML = '';
    
    // Set genres
    if (content.genres && content.genres.length > 0) {
        content.genres.forEach(genre => {
            const genreSpan = document.createElement('span');
            genreSpan.className = 'bg-gray-800 text-gray-300 px-2 py-1 rounded-md text-xs';
            genreSpan.textContent = genre.name;
            genresEl.appendChild(genreSpan);
        });
    } else {
        genresEl.innerHTML = '<span class="text-gray-400 text-sm">No genre information</span>';
    }
    
    // Set cast (if available)
    if (content.credits?.cast) {
        content.credits.cast.slice(0, 5).forEach(actor => {
            const actorSpan = document.createElement('span');
            actorSpan.className = 'bg-gray-800 text-gray-300 px-2 py-1 rounded-md text-xs';
            actorSpan.textContent = actor.name;
            castEl.appendChild(actorSpan);
        });
    } else if (content.cast) {
        // Fallback for TV shows if cast is in different format
        content.cast.slice(0, 5).forEach(actor => {
            const actorSpan = document.createElement('span');
            actorSpan.className = 'bg-gray-800 text-gray-300 px-2 py-1 rounded-md text-xs';
            actorSpan.textContent = actor;
            castEl.appendChild(actorSpan);
        });
    } else {
        castEl.innerHTML = '<span class="text-gray-400 text-sm">No cast information</span>';
    }
    
    // Set play button data
    const modalPlayButton = document.getElementById('modal-play-button');
    modalPlayButton.dataset.id = content.id;
    modalPlayButton.dataset.type = contentType;

document.getElementById('modal-play-button').addEventListener('click', () => {
    const movieModal = document.getElementById('movie-modal');
    const content = JSON.parse(movieModal.dataset.currentContent);
    playMovie(content);
});
    
    // Close modal handler
    document.getElementById('close-modal').addEventListener('click', () => {
                setTimeout(() => {
            movieModal.classList.add('hidden');
            // RIPRISTINA le classi di animazione
            movieModal.classList.remove('opacity-100', 'scale-100');
        }, 300);
    });
    
    
    // Close with Escape key
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !movieModal.classList.contains('hidden')) {
                            setTimeout(() => {
            movieModal.classList.add('hidden');
            // RIPRISTINA le classi di animazione
            movieModal.classList.remove('opacity-100', 'scale-100');
        }, 300);
        }
    });
}


        
        // Show movie details in modal
 
        
    </script>

      <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('‚úÖ Service Worker registrato:', reg))
      .catch(err => console.error('‚ùå Service Worker errore:', err));
  }
</script>

<script>

   const API_URL = 'https://api.themoviedb.org/3';
const API_KEY = 'TUO_API_KEY'; // ‚Üê sostituisci con la tua API key

const GENRE_MAP = {
  // Sezioni speciali
  'trending-movies': { type: 'movie', endpoint: 'trending/movie/week' },
  'popular-tv': { type: 'tv', endpoint: 'tv/popular' },
  'top-rated-movies': { type: 'movie', endpoint: 'movie/top_rated' },
  'now-playing': { type: 'movie', endpoint: 'movie/now_playing' },

  // Generi
  action: { type: 'movie', genreId: 28 },
  fantasy: { type: 'movie', genreId: 14 },
  drama: { type: 'movie', genreId: 18 },
  scifi: { type: 'movie', genreId: 878 },
  horror: { type: 'movie', genreId: 27 },
  'teen-drama': { type: 'movie', genreId: 10751 },
  romantic: { type: 'movie', genreId: 10749 },

  // Paesi
  'korean-drama': { type: 'tv', originCountry: 'KR' },
  'korean-movie': { type: 'movie', originCountry: 'KR' }
};

document.addEventListener('DOMContentLoaded', () => {
  Object.entries(GENRE_MAP).forEach(([key, config]) => {
    const containerId = `carousel-${key}-container`;
    if (config.endpoint) {
      loadFromEndpoint(containerId, config.endpoint, config.type);
    } else if (config.genreId) {
      loadByGenre(containerId, config.genreId, config.type);
    } else if (config.originCountry) {
      loadByCountry(containerId, config.originCountry, config.type);
    }
  });
});

async function loadFromEndpoint(containerId, endpoint, type) {
  const container = document.getElementById(containerId);
  if (!container) return;

  try {
    const res = await fetch(`${API_URL}/${endpoint}?api_key=${API_KEY}&language=it-IT`);
    const data = await res.json();
    container.innerHTML = '';
    data.results.slice(0, 10).forEach(item => {
      if (item.poster_path) container.appendChild(createMovieCard(item, type));
    });
  } catch (err) {
    console.error(`Errore nella sezione ${containerId}:`, err);
  }
}

async function loadByGenre(containerId, genreId, type) {
  const container = document.getElementById(containerId);
  if (!container) return;

  try {
    const res = await fetch(`${API_URL}/discover/${type}?api_key=${API_KEY}&with_genres=${genreId}&sort_by=popularity.desc&language=it-IT`);
    const data = await res.json();
    container.innerHTML = '';
    data.results.slice(0, 10).forEach(item => {
      if (item.poster_path) container.appendChild(createMovieCard(item, type));
    });
  } catch (err) {
    console.error(`Errore nella sezione ${containerId}:`, err);
  }
}

async function loadByCountry(containerId, countryCode, type) {
  const container = document.getElementById(containerId);
  if (!container) return;

  try {
    const res = await fetch(`${API_URL}/discover/${type}?api_key=${API_KEY}&with_origin_country=${countryCode}&sort_by=popularity.desc&language=it-IT`);
    const data = await res.json();
    container.innerHTML = '';
    data.results.slice(0, 10).forEach(item => {
      if (item.poster_path) container.appendChild(createMovieCard(item, type));
    });
  } catch (err) {
    console.error(`Errore nella sezione ${containerId}:`, err);
  }
} 
    
</script>


</body>
</html>
